<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="theme-color" content="#1C1C1C">
    <title>CSRacing - Interface Caissier</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
        @keyframes loading {
            0% {
                transform: rotate(0)
            }

            to {
                transform: rotate(360deg)
            }
        }

        .ag-textarea .MuiInputBase-input {
            overflow: hidden !important;
        }

        .ag-textarea .MuiInputBase-input::-webkit-scrollbar {
            display: none !important;
        }

        .participants_container {
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }

        .participants {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-row-gap: 5px;
            grid-column-gap: 5px;
            justify-items: center;
            height: 100vh;
            padding: 5px;
            overflow: hidden;
        }

        .translated-content .ytCoreImageHost {
            visibility: visible;
        }

        /* Réduire modérément la taille pour iframe */
        .money-horse-section .game_screen .participant {
            width: 280px !important;
            height: 140px !important;
            transform: scale(0.9) !important;
            transform-origin: top center !important;
            margin: -5px 0 !important;
        }

        .money-horse-section .game_screen .participant .name {
            font-size: 16px !important;
        }

        .money-horse-section .game_screen .participant .coeff {
            font-size: 21px !important;
        }

        .money-horse-section .game_screen .participant .coeff_hint {
            font-size: 11px !important;
        }

        .money-horse-section .game_screen .participant .bet {
            height: 35px !important;
        }

        /* Réduire la taille des contrôles */
        .money-horse-section .game_screen .controls {
            margin-top: -20px !important;
            display: flex !important;
            gap: 5px !important;
            justify-content: center !important;
        }

        .money-horse-section .game_screen .controls .button {
            font-size: 16px !important;
            padding: 10px 18px !important;
            margin: 0 !important;
            height: auto !important;
            min-height: 40px !important;
        }

        /* Le conteneur des boutons */
        .amount-grid {
            display: none !important;
            /* Crée 4 colonnes de largeur égale */
            grid-template-columns: repeat(4, 1fr) !important;
            /* Ajoute un espace entre les boutons */
            gap: 5px !important;
            margin-top: 8px !important;
            margin-bottom: 8px !important;
            padding: 8px !important;
            width: 185px !important;
            max-width: 320px !important;
            background-color: #ffffff !important;
            border: 1px solid #ddd !important;
            border-radius: 4px !important;
            box-sizing: border-box !important;
        }

        .amount-grid[style*="display: grid"] {
            display: grid !important;
        }

        .amount-grid[style*="display: block"] {
            display: grid !important;
        }

        /* Style optionnel pour rendre les boutons plus jolis */
        .amount-btn {
            width: 100% !important;
            /* Le bouton prend toute la largeur de la colonne */
            padding: 8px 6px !important;
            /* Espace intérieur pour le confort du clic */
            cursor: pointer !important;
            background-color: #f0f0f0 !important;
            border: 1px solid #ccc !important;
            border-radius: 3px !important;
            font-weight: bold !important;
            font-size: 12px !important;
            transition: background-color 0.2s !important;
        }

        .amount-btn:hover {
            background-color: #e0e0e0 !important;
        }

        .amount-btn:active {
            background-color: #d0d0d0 !important;
        }
    </style>
</head>

<body class="">
    <link rel="stylesheet" href="/css/print.min.css?v=33054">
    <link rel="stylesheet" href="/css/styles.css?v=33054">
    <link rel="stylesheet" href="/css/responsive.css?v=33054">

    <section class="money-horse-section js-money-horse-section">
        <div class="content">

            <div class="screen game_screen active">
                <div class="participants_container">
                    <div class="participants">

                        <div class="js_template" style="display:none;">
                            <div class="avatar_background">
                                <div class="avatar"></div>
                            </div>
                            <div class="name"></div>
                            <div class="coeff_container">
                                <div class="coeff"></div>
                                <div data-l10n-id="horse_prize_coef" class="coeff_hint"></div>
                            </div>
                            <div class="bet">
                                <form class="create">
                                    <input type="number" placeholder="Bet" tabindex="1" class="value" min="0"
                                        step="0.01">

                                    <div class="amount-grid">
                                        <button type="button" class="amount-btn" data-amount="25">25</button>
                                        <button type="button" class="amount-btn" data-amount="50">50</button>
                                        <button type="button" class="amount-btn" data-amount="100">100</button>
                                        <button type="button" class="amount-btn" data-amount="250">250</button>

                                        <button type="button" class="amount-btn" data-amount="500">500</button>
                                        <button type="button" class="amount-btn" data-amount="1000">1000</button>
                                        <button type="button" class="amount-btn" data-amount="2500">2500</button>
                                        <button type="button" class="amount-btn" data-amount="5000">5000</button>
                                    </div>

                                    <input type="submit" value="ok" class="confirm">
                                </form>

                                <div class="view">
                                    <div class="value"></div>
                                    <div class="prize"></div>
                                    <button class="cancel"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button data-l10n-id="horse_add_receipt" class="button add_receipt">Accept bet</button>
                    <button data-l10n-id="horse_added_receipts" class="button added_receipt">
                        Receipts (<span class="count">0</span>)
                    </button>
                </div>
            </div>

        </div>

        <div class="loading_indicator">
            <div data-l10n-id="horse_loading" class="message">
                <div>Please, wait...</div>
                <div class="lds-hourglass"></div>
            </div>
        </div>
        <div class="notification_container">
            <div class="js_template">
                <button class="close"></button>
                <div class="message"></div>
            </div>
        </div>
    </section>

    <!-- ✅ Configuration WebSocket (DOIT être en premier) -->
    <script src="/js/websocket-config.js"></script>
    
    <script src="/js/print.min.js?v=33054"></script>
    <script src="/js/jquery_min.js?v=33054"></script>
    <script src="/js/big_min.js?v=33054"></script>
    <script src="/js/async.min.js?v=33054"></script>
    <script src="/js/crafty-0.5.4.js?v=33054"></script>
    <script src="/js/currency.js?v=33054"></script>
    <script src="/js/context.js?v=33054"></script>
    <script src="/js/managers.js?v=33054"></script>
    <script src="/js/misc.js?v=33054"></script>
    <script src="/js/models.js?v=33054"></script>
    <script src="/js/server.js?v=33054"></script>
    <script src="/js/webclient.js?v=33054"></script>
    <script src="/js/user_manager.js?v=33054"></script>
    <script src="/js/components.js?v=33054"></script>
    <script src="/js/movie.js?v=33054"></script>
    <script src="/js/path_generator.js?v=33054"></script>
    <script src="/js/scene_builders.js?v=33054"></script>
    <script src="/js/game.js?v=33054"></script>
    <script src="/js/movie1.js?v=33054"></script>
    <script src="/js/finish.js?v=33054"></script>
    <script src="/js/fullscreen.js?v=33054"></script>

    <script src="/js/centrifuge.min.js"></script>
    <script src="/js/jackpots.ws.js?v=33054"></script>
    <script src="/js/main.js?v=33054"></script>
    <link rel="stylesheet" href="/css/jackpots.css?v=33054">

    <!-- Script pour gérer la grille de montants -->
    <script>
        // Utiliser jQuery pour mieux gérer les éléments dynamiques
        $(document).on('focus', '.value', function () {
            $(this).closest('.create').find('.amount-grid').show();
            console.log('Grille affichée au focus');
        });

        $(document).on('blur', '.value', function () {
            const $grid = $(this).closest('.create').find('.amount-grid');
            setTimeout(() => {
                $grid.hide();
                console.log('Grille masquée au blur');
            }, 100);
        });

        $(document).on('click', '.amount-btn', function (e) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();

            const $button = $(this);
            const amount = parseFloat($button.data('amount'));
            const $form = $button.closest('.create');
            const $input = $form.find('.value');
            const $participantContainer = $form.closest('.participant');

            console.log('Montant cliqué:', amount);
            console.log('Input avant:', $input.val());

            if ($input.length > 0) {
                // Ajouter le montant au montant existant
                const currentValue = parseFloat($input.val()) || 0;
                const newValue = currentValue + amount;

                console.log('Nouvelle valeur:', newValue);

                // Mettre à jour l'input avec la nouvelle valeur
                $input.val(newValue);

                // Ajouter la classe has_value pour afficher le bouton ok
                $form.addClass('has_value');

                // Déclencher les événements change et input
                $input.trigger('change');
                $input.trigger('input');

                // Mettre à jour l'affichage du prize (gain) si on peut le calculer
                if ($participantContainer.length > 0) {
                    const coeff = parseFloat($participantContainer.find('.coeff').text());
                    if (!isNaN(coeff) && coeff > 0) {
                        const prizeValue = newValue * coeff;
                        $form.next('.view').find('.value').text(newValue.toFixed(2));
                        $form.next('.view').find('.prize').text(prizeValue.toFixed(2));
                    }
                }

                console.log('Input après:', $input.val());

                // Garder le focus sur l'input
                $input.focus();
            }

            return false;
        });

        // ✅ NOUVEAU: Masquer la grille des montants après la soumission du formulaire
        $(document).on('submit', '.create', function (e) {
            const $form = $(this);
            const $grid = $form.find('.amount-grid');
            
            // Masquer la grille avec transition
            $grid.fadeOut(300, function () {
                console.log('Grille des montants masquée après validation');
            });
        });

        // ✅ NOUVEAU: Masquer la grille quand on clique ailleurs (modal behavior)
        $(document).on('click', function (e) {
            // Vérifier si on a cliqué sur une grille ou ses boutons
            const $clickedElement = $(e.target);
            const isClickOnGrid = $clickedElement.closest('.amount-grid').length > 0;
            const isClickOnAmountBtn = $clickedElement.hasClass('amount-btn');
            const isClickOnInput = $clickedElement.hasClass('value');
            
            // Si on a cliqué ailleurs (pas sur la grille, pas sur les boutons, pas sur l'input)
            if (!isClickOnGrid && !isClickOnAmountBtn && !isClickOnInput) {
                // Masquer toutes les grilles affichées
                $('.amount-grid:visible').fadeOut(300, function () {
                    console.log('Grille fermée (clic ailleurs)');
                });
            }
        });
    </script>

</body>

</html>