<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tableau de bord — HITBET777</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    .section-card {
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .section-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at top right, rgba(16, 185, 129, 0.1), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .section-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(16, 185, 129, 0.2);
    }

    .section-card:hover::before {
      opacity: 1;
    }

    .icon-wrapper {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
      transition: transform 0.3s ease;
    }

    .section-card:hover .icon-wrapper {
      transform: scale(1.1) rotate(5deg);
    }

    .icon-wrapper i {
      color: white;
      font-size: 48px;
    }

    .header {
      animation: slideDown 0.6s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .cards-container > div {
      animation: fadeIn 0.6s ease-out;
      animation-fill-mode: both;
    }

    .cards-container > div:nth-child(1) {
      animation-delay: 0.2s;
    }

    .cards-container > div:nth-child(2) {
      animation-delay: 0.4s;
    }

    .button-primary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      transition: all 0.3s ease;
    }

    .button-primary:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
    }

    .logout-btn {
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background-color: rgba(239, 68, 68, 0.2);
    }

    .user-info {
      animation: slideDown 0.6s ease-out 0.6s both;
    }
  </style>
</head>
<body class="text-slate-100 min-h-screen flex flex-col">
  <!-- Header with logout button -->
  <header class="bg-slate-800/40 backdrop-blur border-b border-slate-700/50 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <i class="fas fa-horse text-emerald-400 text-2xl"></i>
        <h1 class="text-2xl font-bold">HITBET777</h1>
      </div>
      <button id="logoutBtn" class="logout-btn px-4 py-2 rounded-lg text-slate-300 hover:text-red-400 flex items-center gap-2 transition-colors">
        <i class="fas fa-sign-out-alt"></i>
        <span class="hidden sm:inline">Déconnexion</span>
      </button>
    </div>
  </header>

  <!-- Main content -->
  <div class="flex-1 flex items-center justify-center px-4 py-12">
    <div class="w-full max-w-5xl">
      <!-- Welcome header -->
      <div class="header text-center mb-12">
        <h2 class="text-4xl sm:text-5xl font-bold mb-3">Bienvenue au tableau de bord</h2>
        <p class="text-lg text-slate-400">Sélectionnez une section pour continuer</p>
        <div class="user-info mt-4 text-sm text-slate-400">
          <span id="userDisplay">Utilisateur</span>
        </div>
      </div>

      <!-- Cards grid -->
      <div class="cards-container grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Screen Card -->
        <div class="section-card bg-slate-800/50 backdrop-blur border border-slate-700/50 rounded-2xl p-8 md:p-10 text-center" onclick="openScreen()">
          <div class="flex flex-col items-center">
            <div class="icon-wrapper">
              <i class="fas fa-tv"></i>
            </div>
            <h3 class="text-2xl font-bold mb-3">Écran</h3>
            <p class="text-slate-400 mb-6">Tableau de bord de diffusion TV</p>
            <p class="text-sm text-slate-500 mb-6">Visualisez les courses en direct et les résultats</p>
            <div class="inline-block px-6 py-2 rounded-lg button-primary font-semibold">
              Ouvrir <i class="fas fa-arrow-up-right ml-2"></i>
            </div>
          </div>
        </div>

        <!-- Cashier Card -->
        <div class="section-card bg-slate-800/50 backdrop-blur border border-slate-700/50 rounded-2xl p-8 md:p-10 text-center" onclick="openCashier()">
          <div class="flex flex-col items-center">
            <div class="icon-wrapper">
              <i class="fas fa-cash-register"></i>
            </div>
            <h3 class="text-2xl font-bold mb-3">Caissier</h3>
            <p class="text-slate-400 mb-6">Interface de gestion des mises</p>
            <p class="text-sm text-slate-500 mb-6">Gérez les paiements et les reçus</p>
            <div class="inline-block px-6 py-2 rounded-lg button-primary font-semibold">
              Ouvrir <i class="fas fa-arrow-up-right ml-2"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Info section -->
      <div class="mt-12 pt-8 border-t border-slate-700/50 text-center">
        <p class="text-sm text-slate-500">
          Chaque section s'ouvrira dans une nouvelle fenêtre pour une meilleure expérience multi-écran.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Get user info from localStorage or API
    function initDashboard() {
      const userDisplay = document.getElementById('userDisplay');
      
      // Try to get user info from localStorage
      const userInfo = localStorage.getItem('userInfo');
      if (userInfo) {
        try {
          const user = JSON.parse(userInfo);
          userDisplay.textContent = `Connecté en tant que: ${user.username || 'Utilisateur'}`;
        } catch (e) {
          console.error('Error parsing user info:', e);
        }
      }

      // Check if user is authenticated
      const token = localStorage.getItem('authToken');
      if (!token) {
        // Not authenticated, redirect to login
        window.location.href = '/';
      }
    }

    // Open screen in new window
    function openScreen() {
      const width = 1920;
      const height = 1080;
      const left = window.screenX + (window.outerWidth - width) / 2;
      const top = window.screenY + (window.outerHeight - height) / 2;
      
      const screenWindow = window.open(
        '/screen',
        'screen_broadcast',
        `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=no,status=no,menubar=no,toolbar=no`
      );
      
      if (!screenWindow) {
        alert('Impossible d\'ouvrir la fenêtre. Vérifiez vos paramètres de bloqueur de pop-ups.');
      }
    }

    // Open cashier in new window
    function openCashier() {
      const width = 1400;
      const height = 900;
      const left = window.screenX + (window.outerWidth - width) / 2;
      const top = window.screenY + (window.outerHeight - height) / 2;
      
      const cashierWindow = window.open(
        '/cashier',
        'cashier_interface',
        `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes,status=no,menubar=no,toolbar=no`
      );
      
      if (!cashierWindow) {
        alert('Impossible d\'ouvrir la fenêtre. Vérifiez vos paramètres de bloqueur de pop-ups.');
      }
    }

    // Logout handler
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
        try {
          // Optional: notify server of logout
          await fetch('/api/v1/auth/logout', { method: 'POST' }).catch(() => {});
          
          // Clear stored auth data
          localStorage.removeItem('authToken');
          localStorage.removeItem('userInfo');
          
          // Redirect to login
          window.location.href = '/';
        } catch (err) {
          console.error('Logout error:', err);
          // Still redirect even if logout API fails
          window.location.href = '/';
        }
      }
    });

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', initDashboard);
  </script>
</body>
</html>
